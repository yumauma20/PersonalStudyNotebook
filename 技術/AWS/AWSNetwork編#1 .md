# 01
## VPCとは
- Virtual Private Cloudの略
- クラウド内にプライベートネットワークを構築
- 既存データセンターの延長

- AZ
  - abailabilty zoneの略

企業とインターネットの受け口的な感じで使われる

## オンプレミスとAWS接続
- VPNや専用線を使った標準技術

# 02
## 東京リージョン内にVPC作成

- VPC全体に利用するIPアドレス空間は余裕を持たせる
- 設定可能なネットマスク16bit~28bit

### サブネット
- VPCの中にサブネットを用意する。
- サブネットはAZを跨げない、範囲はネットマスクと同じ

インターネットゲートウェイでVPCにアタッチするインターネットとの接続を確立させる

- プライベートサブネットからインターネットに接続するためには以下のどちらかが必要
  - NATゲートウェイ
  - パブリックサブネット

# 03
サブネットのパブリックプライベートを設定

- ルートテーブルの作成と関連付け

## パブリックサブネットプライベートサブネットの違い
- パブリック
  - ルーティングテーブルにインターネットゲートウェイのエントリがある、
  - インターネットとインバウンド/アウトバウンドのアクセスが可能
- プライベート
  - エントリがなくインターネットから直接アクセスできない

**ルートテーブル**でコントロールできるらしい

サブネットにそれぞれルートテーブルがある
これでプライベートかパブリックか決まる

## ルートテーブルとは
- ネットワークのトラフィックの経路決定する、ルートと呼ばれる一連のルールが定義されているテーブル情報
- 通信経路を決定するもの

# 04
- ターゲットのlocalはVPC内通信という意味
- デフォルトのルートテーブルは
  - VPC内しか経路情報を持っていない
  - インターネット経路は持っていない

0.0.0.0/0 インターネットゲートウェイ

- ルーティングの優先度
  - ネットマスクの数字が大きい方が優先される
  - /以降の数字

- 明示的な関連付けがないサブネット (2)
- `以下のサブネットは、いずれのルートテーブルとも明示的に関連付けられていなかったため、メインルートテーブルに関連付けられています。`

- ルートテーブルにはメインが存在する
  - セキュアなプライベートをメインにして意図的にパブリックにした方が良い運用らしい

# 05
- EC2でウェブサーバー作成

- パブリック IP の自動割り当て
  - パブリックIPアドレスがインスタンスのプライマリネットワークインターフェイスに自動で割り当てられるかどうかのこと

- パブリック IPv4 アドレスでアクセスするとアパッチの初期ページが表示される
  - webサーバーにアクセスできたことになる

# 06
- プライベートサブネットからインターネットへのアクセス方法

- インターネットからのアクセス
  - インバウンド
- インターネットへのアクセス
  - アウトバウンド

インバウンドは拒否したいけどアウトバウンドは接続したいみたいなことがある。これを実現。

- NAT
  - NAT Gateweyが一般的らしい、推奨

0.0.0.0/0送信先
NAT Gateway ターゲット

NATを一旦パブリックにおく
そこから外部へのアクセス

- NAT Gatewayは複数インスタンスを扱うことができる
- プライベートサブネット
  - パブリックサブネットに設置したNATやプロキシを経由することでインターネットへのアウトバウンドのアクセスが可能

# 07
## VPC外のサービスにアクセスするための方法

- インターネットゲートウェイがないとSSMに接続できない
- インターネットゲートウェイを持ちたくない場合
  - セキュアなシステムはプライベートサブネットのみで構成しているのでVPCからインターネットに接続性を持たせない構成もある

- VPC Endpoint,AWS PrivateLink
  - VPC内subnetで稼働するサービスからVPC外サービスと直接通信可能

- サービスによって接続する方式が違う。上二つのやつで。

- VPC Endpoint
  - Gateway
  - ルーティングで完結
  - 経路状の選択、ルートテーブルとの関連性が高い
- AWS PrivateLink
  - Interface
  - VPCの中のサブネットのIPアドレスが生成される
  - パブリックにおく

# まとめ
## 設定した流れ
1. VPC
2. サブネット
3. インターネットゲートウェイ
4. ルートテーブル
5. IAMROLE 
6. EC2
7. セキュリティーグルプ
8. NAT GATEWAY
9. EC2
10. VPC Interface SSM作成
11. S3バケット
12. Gateway

削除するなら逆の順番で

![Alt text](https://pages.awscloud.com/rs/112-TZM-766/images/Hands-On-for-Beginners_2022_Network1_0819_v1.png)